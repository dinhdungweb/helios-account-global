{{ 'account.css' | asset_url | stylesheet_tag: preload: true }}

{% comment %}Import Logic{% endcomment %}
{% include 'account-tier-logic' %}

{% comment %}--- DASHBOARD HERO (V2) ---{% endcomment %}
{% include 'account-hero' %}

{% comment %}--- DASHBOARD NAV (V2) ---{% endcomment %}
{% include 'account-nav' %}

<div class="account-container account-dashboard-body">
  {% comment %}--- TAB CONTENT AREA ---{% endcomment %}

    {% comment %}--- TAB: WELCOME ---{% endcomment %}
    <div id="rewards" class="dashboard-tab-content active">
      <div class="dashboard-card welcome-card">
        <h3 class="card-title">Welcome</h3>
        <div class="card-body">
          {% render 'account-tier-content', tier: tier, type: 'welcome' %}
          <div class="tier-image-container">
            {% if section.settings.tier_image != blank %}
              <img src="{{ section.settings.tier_image | image_url: width: 1200 }}" alt="Tier Image" loading="lazy"/>
            {% else %}
               <img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/SRK00644-2.jpg?v=1764068164" alt=""/>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% comment %}--- TAB: ACCOUNT INFO ---{% endcomment %}
    <div id="account" class="dashboard-tab-content">
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <h3 class="card-title">Thông Tin Cá Nhân</h3>
          <div class="card-body info-list">
             <div class="info-row">
               <span class="info-label">Họ và tên:</span>
               <span class="info-value">{{ customer.name }}</span>
             </div>
             <div class="info-row">
               <span class="info-label">Email:</span>
               <span class="info-value">{{ customer.email }}</span>
             </div>
             <div class="info-row">
               <span class="info-label">Số điện thoại:</span>
               <span class="info-value">{{ customer.default_address.phone | default: 'Chưa cập nhật' }}</span>
             </div>
          </div>
        </div>
        
        <div class="dashboard-card">
          <h3 class="card-title">Địa Chỉ Mặc Định</h3>
          <div class="card-body">
            {% if customer.default_address %}
              <div class="address-display">
                <p>{{ customer.default_address.company }}</p>
                <p>{{ customer.default_address.street }}</p>
                <p>{{ customer.default_address.city }} {% if customer.default_address.province_code %}, {{ customer.default_address.province_code }}{% endif %}</p>
                <p>{{ customer.default_address.country }}</p>
                <p>{{ customer.default_address.zip }}</p>
              </div>
            {% else %}
              <p>Chưa có địa chỉ mặc định</p>
            {% endif %}
             <a class="dashboard-btn outline mt-20" href="{{ routes.account_addresses_url }}">Quản Lý Địa Chỉ</a>
          </div>
        </div>
      </div>
    </div>

    {% comment %}--- TAB: ORDERS ---{% endcomment %}
    <div id="orders" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Lịch Sử Mua Hàng</h3>
        <div class="card-body">
          {% paginate customer.orders by 20 %}
          {% if customer.orders.size != 0 %}
          <div class="table-responsive">
            <table class="dashboard-table">
              <thead>
                <tr>
                  <th>Mã Đơn</th>
                  <th>Ngày Đặt</th>
                  <th>Trạng Thái</th>
                  <th>Tổng Tiền</th>
                </tr>
              </thead>
              <tbody>
                {% for order in customer.orders %}
                <tr>
                  <td><a href="{{ order.customer_url }}" class="order-link">{{ order.name }}</a></td>
                  <td>{{ order.created_at | date: format: 'month_date_year' }}</td>
                  <td><span class="status-badge {{ order.financial_status_label | handle }}">{{ order.financial_status_label }}</span></td>
                  <td class="order-total">{{ order.total_price | money }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
            <div class="empty-state">
              <p>Bạn chưa có đơn hàng nào.</p>
              <a href="{{ routes.all_products_collection_url }}" class="dashboard-btn">Mua Sắm Ngay</a>
            </div>
          {% endif %}
          {% endpaginate %}
        </div>
      </div>
    </div>

    {% comment %}--- TAB: BENEFITS ---{% endcomment %}
    <div id="benefits" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Quyền Lợi & Ưu Đãi</h3>
        <div class="card-body">
           {% render 'account-tier-content', tier: tier, type: 'benefits' %}
        </div>
      </div>
    </div>

    {% comment %}--- TAB: POINTS EXCHANGE ---{% endcomment %}
    <div id="points" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Đổi Điểm Thưởng</h3>
        <div class="card-body">
           {% render 'account-points-tab', points: points, customer: customer %}
        </div>
      </div>
    </div>

    {% comment %}--- TAB: COMMUNITY ---{% endcomment %}
    <div id="discord" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Helios Community</h3>
        <div class="card-body community-layout">
           <div class="community-img">
             <img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/z6465765703069_030e64083cc975d6127ff8a441409631_95f8c0e0-1f78-4f16-b036-4de58aa1d26c.jpg?v=1743569814" alt="Helios Community"/>
           </div>
           <div class="community-text">
              <p>Helios Club là cộng đồng dành riêng cho những người ‘khác biệt’– những anh em quan tâm đến thời trang, phụ kiện và đặc biệt là những ai đam mê ‘màu’ Helios.</p>
              <p>Đây là nơi để anh em chia sẻ trải nghiệm, kinh nghiệm sử dụng phụ kiện, những câu chuyện phía sau món đồ; đồng thời là không gian mở để đặt câu hỏi, tư vấn, trao đổi và thảo luận một cách thẳng thắn và chân thành.</p>
              <p>Nếu bạn yêu thích sự khác biệt: Chào mừng bạn đến với Helios Club!</p>
              <a href="https://www.facebook.com/groups/508707569692422" target="_blank" class="dashboard-btn" style="margin-top:20px;">Tham gia ngay</a>
           </div>
        </div>
      </div>
    </div>

    {% comment %}--- CUSTOM TABS ---{% endcomment %}
    {% for block in section.blocks %}
      {% if block.type == 'custom_tab' %}
        <div id="custom-tab-{{ block.id }}" class="dashboard-tab-content">
           <div class="dashboard-card">
             <h3 class="card-title">{{ block.settings.title }}</h3>
             <div class="card-body">
               {% if block.settings.page_content != blank %}
                 {{ pages[block.settings.page_content].content }}
               {% else %}
                 <div class="rte">
                   {{ block.settings.richtext_content }}
                 </div>
               {% endif %}
             </div>
           </div>
        </div>
      {% endif %}
    {% endfor %}

</div>

<script>
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', function () {
    if(this.classList.contains('logout-tab')) return; // Allow normal link for logout
    
    const tabId = this.dataset.tab;
    
    // Deactivate all
    document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.dashboard-tab-content').forEach(el => el.classList.remove('active'));
    
    // Activate clicked
    this.classList.add('active');
    const content = document.getElementById(tabId);
    if(content) content.classList.add('active');
  });
});
</script>

{% schema %}
{
  "name": "Main Account",
  "settings": [
    {
      "type": "image_picker",
      "id": "tier_image",
      "label": "Ảnh trang chủ Hạng (Mặc định)"
    }
  ],
  "blocks": [
    {
      "type": "tier_config",
      "name": "Cấu hình Hạng",
      "settings": [
        {
          "type": "text",
          "id": "tier_tag",
          "label": "Thẻ khách hàng (Tag)",
          "info": "Ví dụ: SILVER, GOLD, MEMBER"
        },
        {
          "type": "richtext",
          "id": "welcome_message",
          "label": "Lời chào mừng",
           "default": "<p>Chào mừng bạn đến với Helios!</p>"
        },
        {
          "type": "richtext",
          "id": "benefits_content",
          "label": "Nội dung Quyền lợi"
        }
      ]
    },
    {
      "type": "custom_tab",
      "name": "Tab Tùy Chỉnh",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tiêu đề Tab",
          "default": "Tab Mới"
        },
        {
          "type": "page",
          "id": "page_content",
          "label": "Nội dung từ Trang (Ưu tiên)"
        },
        {
          "type": "richtext",
          "id": "richtext_content",
          "label": "Nội dung văn bản"
        }
      ]
    },
    {
       "type": "@app"
    }
  ]
}
{% endschema %}
