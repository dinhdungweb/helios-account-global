{{ 'account.css' | asset_url | stylesheet_tag: preload: true }}

{% comment %}Import Logic{% endcomment %}
{% include 'account-tier-logic' %}

{% comment %}--- DASHBOARD HERO (V2) ---{% endcomment %}
{% include 'account-hero' %}

{% comment %}--- DASHBOARD NAV (V2) ---{% endcomment %}
{% include 'account-nav' %}

<div class="account-container account-dashboard-body">
  {% comment %}--- TAB CONTENT AREA ---{% endcomment %}

    {% comment %}--- TAB: WELCOME ---{% endcomment %}
    <div id="rewards" class="dashboard-tab-content active">
      <div class="dashboard-card welcome-card">
        <h3 class="card-title">Welcome</h3>
        <div class="card-body">
          {% render 'account-tier-content', tier: tier, type: 'welcome' %}
          <div class="tier-image-container">
            {% if section.settings.tier_image != blank %}
              <img src="{{ section.settings.tier_image | image_url: width: 1200 }}" alt="Tier Image" loading="lazy"/>
            {% else %}
               <img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/SRK00644-2.jpg?v=1764068164" alt=""/>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    {% comment %}--- TAB: ACCOUNT INFO ---{% endcomment %}
    <div id="account" class="dashboard-tab-content">
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <h3 class="card-title">Personal Information</h3>
          <div class="card-body info-list">
             <div class="info-row">
               <span class="info-label">Full name:</span>
               <span class="info-value">{{ customer.name }}</span>
             </div>
             <div class="info-row">
               <span class="info-label">Email:</span>
               <span class="info-value">{{ customer.email }}</span>
             </div>
             <div class="info-row">
               <span class="info-label">Phone:</span>
               <span class="info-value">{{ customer.default_address.phone | default: 'Not updated' }}</span>
             </div>
          </div>
        </div>
        
        <div class="dashboard-card">
          <h3 class="card-title">Default Address</h3>
          <div class="card-body">
            {% if customer.default_address %}
              <div class="address-display">
                <p>{{ customer.default_address.company }}</p>
                <p>{{ customer.default_address.street }}</p>
                <p>{{ customer.default_address.city }} {% if customer.default_address.province_code %}, {{ customer.default_address.province_code }}{% endif %}</p>
                <p>{{ customer.default_address.country }}</p>
                <p>{{ customer.default_address.zip }}</p>
              </div>
            {% else %}
              <p>No default address</p>
            {% endif %}
             <a class="dashboard-btn outline mt-20" href="{{ routes.account_addresses_url }}">Manage Addresses</a>
          </div>
        </div>
      </div>
    </div>

    {% comment %}--- TAB: ORDERS ---{% endcomment %}
    <div id="orders" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Order History</h3>
        <div class="card-body">
          {% paginate customer.orders by 20 %}
          {% if customer.orders.size != 0 %}
          <div class="table-responsive">
            <table class="dashboard-table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                {% for order in customer.orders %}
                <tr>
                  <td><a href="{{ order.customer_url }}" class="order-link">{{ order.name }}</a></td>
                  <td>{{ order.created_at | date: format: 'month_date_year' }}</td>
                  <td><span class="status-badge {{ order.financial_status_label | handle }}">{{ order.financial_status_label }}</span></td>
                  <td class="order-total">{{ order.total_price | money }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
            <div class="empty-state">
              <p>You haven't placed any orders yet.</p>
              <a href="{{ routes.all_products_collection_url }}" class="dashboard-btn">Shop Now</a>
            </div>
          {% endif %}
          {% endpaginate %}
        </div>
      </div>
    </div>

    {% comment %}--- TAB: BENEFITS ---{% endcomment %}
    <div id="benefits" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Benefits & Offers</h3>
        <div class="card-body">
           {% render 'account-tier-content', tier: tier, type: 'benefits' %}
        </div>
      </div>
    </div>

    {% comment %}--- TAB: POINTS EXCHANGE ---{% endcomment %}
    <div id="points" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Redeem Rewards</h3>
        <div class="card-body">
           {% render 'account-points-tab', points: points, customer: customer %}
        </div>
      </div>
    </div>

    {% comment %}--- TAB: COMMUNITY ---{% endcomment %}
    {% comment %} <div id="discord" class="dashboard-tab-content">
      <div class="dashboard-card">
        <h3 class="card-title">Helios Community</h3>
        <div class="card-body community-layout">
           <div class="community-img">
             <img src="https://cdn.shopify.com/s/files/1/0644/2958/8701/files/z6465765703069_030e64083cc975d6127ff8a441409631_95f8c0e0-1f78-4f16-b036-4de58aa1d26c.jpg?v=1743569814" alt="Helios Community"/>
           </div>
           <div class="community-text">
              <p>Helios Club is a community exclusively for those who are ‘different’ – brothers who care about fashion, accessories, and especially those who are passionate about the ‘color’ of Helios.</p>
              <p>This is a place for brothers to share experiences, usage tips, and the stories behind the items; it is also an open space to ask questions, consult, exchange, and discuss frankly and sincerely.</p>
              <p>If you love being different: Welcome to Helios Club!</p>
              <a href="https://www.facebook.com/groups/508707569692422" target="_blank" class="dashboard-btn" style="margin-top:20px;">Join now</a>
           </div>
        </div>
      </div>
    </div> {% endcomment %}

    {% comment %}--- CUSTOM TABS ---{% endcomment %}
    {% for block in section.blocks %}
      {% if block.type == 'custom_tab' %}
        <div id="custom-tab-{{ block.id }}" class="dashboard-tab-content">
           <div class="dashboard-card">
             <h3 class="card-title">{{ block.settings.title }}</h3>
             <div class="card-body">
               {% if block.settings.page_content != blank %}
                 {{ pages[block.settings.page_content].content }}
               {% else %}
                 <div class="rte">
                   {{ block.settings.richtext_content }}
                 </div>
               {% endif %}
             </div>
           </div>
        </div>
      {% endif %}
    {% endfor %}

</div>

<script>
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', function () {
    if(this.classList.contains('logout-tab')) return; // Allow normal link for logout
    
    const tabId = this.dataset.tab;
    
    // Deactivate all
    document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.dashboard-tab-content').forEach(el => el.classList.remove('active'));
    
    // Activate clicked
    this.classList.add('active');
    const content = document.getElementById(tabId);
    if(content) content.classList.add('active');
  });
});
</script>

{% schema %}
{
  "name": "Main Account",
  "settings": [
    {
      "type": "image_picker",
      "id": "tier_image",
      "label": "Tier Home Image (Default)"
    }
  ],
  "blocks": [
    {
      "type": "tier_config",
      "name": "Tier Configuration",
      "settings": [
        {
          "type": "text",
          "id": "tier_tag",
          "label": "Customer Tag",
          "info": "Example: SILVER, GOLD, MEMBER"
        },
        {
          "type": "richtext",
          "id": "welcome_message",
           "label": "Welcome Message",
           "default": "<p>Welcome to Helios!</p>"
        },
        {
          "type": "richtext",
          "id": "benefits_content",
           "label": "Benefits Content"
        }
      ]
    },
    {
      "type": "custom_tab",
      "name": "Custom Tab",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tab Title",
          "default": "New Tab"
        },
        {
          "type": "page",
          "id": "page_content",
          "label": "Content from Page (Priority)"
        },
        {
          "type": "richtext",
          "id": "richtext_content",
          "label": "Text Content"
        }
      ]
    },
    {
       "type": "@app"
    }
  ]
}
{% endschema %}
